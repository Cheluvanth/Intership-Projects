###### 

###### -- Create Trigger for Evidence Chain Updates

###### -- This trigger automatically logs custody changes in the EvidenceAudit table

###### 

CREATE OR REPLACE TRIGGER evidence\_chain\_update\_tr

BEFORE UPDATE OF current\_custodian\_id ON Evidence

FOR EACH ROW

WHEN (OLD.current\_custodian\_id != NEW.current\_custodian\_id)

BEGIN

&nbsp;   INSERT INTO EvidenceAudit (

&nbsp;       evidence\_id,

&nbsp;       previous\_custodian\_id,

&nbsp;       new\_custodian\_id,

&nbsp;       change\_timestamp,

&nbsp;       log\_message

&nbsp;   ) VALUES (

&nbsp;       :NEW.evidence\_id,

&nbsp;       :OLD.current\_custodian\_id,

&nbsp;       :NEW.current\_custodian\_id,

&nbsp;       SYSTIMESTAMP,

&nbsp;       'Custody transferred from Officer ' || :OLD.current\_custodian\_id || 

&nbsp;       ' to ' || :NEW.current\_custodian\_id

&nbsp;   );

END;



###### -- Update the custodian of evidence 301



UPDATE Evidence

SET current\_custodian\_id = 102

WHERE evidence\_id = 301;

###### 

###### -- Check the audit log



SELECT \* FROM EvidenceAudit ORDER BY audit\_id DESC;









